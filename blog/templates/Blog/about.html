{% extends "blog/base.html" %}
{% block content %}


<div class="chat-container">
  <h6 class="user-connected">{{ user }}</h6>
 
    <div id="chat" class="chat1"></div>
    <form>
      <input type="text" id="message" />
      <button type="button" id="send">Send</button>
      <button type="button" id="delete-btn">Delete</button>
    </form>

</div>




<script>
const userNameElement = document.querySelector('.user-connected');
const userName = userNameElement.textContent;

let input = document.getElementById("message");
let chatDiv = document.getElementById("chat");
chatDiv.style.overflow = "scroll";
chatDiv.style.height = "400px";

// Charge les messages du chat depuis le stockage local
let messages = loadMessages();

// Affiche les messages du chat
for (let i = 0; i < messages.length; i++) {
  chatDiv.innerHTML += messages[i] + "<br>";
}

let sendButton = document.getElementById("send");
sendButton.addEventListener("click", function() {
  // Récupère le message et le nom de l'utilisateur
  let message = input.value;
  let date = new Date();
  let time = date.toLocaleTimeString();

  // Affiche le message avec le nom de l'utilisateur et l'heure
  let fullMessage = userName + " (" + time + ") : " + message;
  chatDiv.innerHTML += fullMessage + "<br>";

  // Ajoute le message au tableau de messages et enregistre les messages dans le stockage local
  messages.push(fullMessage);
  saveMessages(messages);
});

// Fonction qui charge les messages du chat depuis le stockage local
function loadMessages() {
  return JSON.parse(localStorage.getItem("messages")) || [];
}

// Fonction qui enregistre les messages du chat dans le stockage local
function saveMessages(messages) {
  localStorage.setItem("messages", JSON.stringify(messages));
}

document.getElementById("delete-btn").addEventListener("click", function() {
  // Récupère le dernier message du tableau de messages
  let lastMessage = messages[messages.length - 1];
  // Supprime le dernier message du tableau de messages
  messages.pop();
  // Enregistre les messages mis à jour dans le stockage local
  saveMessages(messages);
  // Supprime le dernier message du chat en utilisant la chaîne de caractères du message
  chatDiv.innerHTML = chatDiv.innerHTML.replace(lastMessage + "<br>", "");
});


</script>




{% endblock content %}
